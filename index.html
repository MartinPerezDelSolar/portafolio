<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Portafolio móvil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      background: #ffffff;  /* FONDO BLANCO */
      overflow: hidden;
      font-family: system-ui, -apple-system, Helvetica, Arial, sans-serif;
      color: #111827;
    }

    /* CONTENEDOR PRINCIPAL CON RULETA */
    .snap-container {
      position: absolute;
      inset: 0;
      overflow-y: scroll;
      overflow-x: hidden;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
      background: #ffffff;
    }

    .snap-container::-webkit-scrollbar { width: 0; height: 0; }

    .panel {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      scroll-snap-align: center;
    }

    .panel-inner {
      width: 100%;
      height: 100%;
      border-radius: 0;
      overflow: hidden;
      background: #ffffff;
      box-shadow: 0 24px 60px rgba(0,0,0,0.06);
      transition:
        transform 0.65s cubic-bezier(0.19, 0.66, 0.24, 1),
        opacity 0.65s ease-out;  /* más suave y fluido */
      transform-origin: center;
    }

    .image-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      overflow: hidden;
    }

    .portfolio-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      transition: filter 0.65s ease-out;  /* blur más fluido */
      will-change: transform, filter, opacity;
    }

    .gradient-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      background:
        radial-gradient(circle at top, rgba(148,163,255,0.14), transparent 60%),
        linear-gradient(to bottom, rgba(255,255,255,0.0), rgba(255,255,255,0.3));
      transition: opacity 0.65s ease-out;
    }

    /* ICONO DE TEXTO — cuadrado suave, derecha centrado */
    .info-toggle {
      position: fixed;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.15);
      background: rgba(30,30,30,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 200;
      backdrop-filter: blur(12px);
      box-shadow: 0 0 14px rgba(0,0,0,0.3);
      opacity: 0.2;
      transition:
        opacity 0.3s ease-out,
        transform 0.25s ease-out;
    }

    .info-toggle.active {
      opacity: 1 !important;
    }

    .info-toggle:hover {
      transform: translateY(-50%) scale(1.06);
      opacity: 0.9;
    }

    .info-toggle-lines,
    .info-toggle-lines::before,
    .info-toggle-lines::after {
      content: "";
      display: block;
      width: 16px;
      height: 2px;
      background: rgba(255,255,255,0.92);
      border-radius: 4px;
      position: relative;
    }

    .info-toggle-lines::before {
      position: absolute;
      top: -5px;
    }

    .info-toggle-lines::after {
      position: absolute;
      top: 5px;
      width: 12px;
      opacity: 0.8;
    }

    /* PANEL DE TEXTO — hoja inferior con blur (ideal móvil) */
    .info-panel {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding-bottom: env(safe-area-inset-bottom);
      height: 40vh;
      max-height: 320px;
      background: rgba(0,0,0,0.75);
      border-radius: 18px 18px 0 0;
      border-top: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(16px);
      padding: 0.9rem 1.2rem 1.2rem;
      box-shadow: 0 -18px 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      transform: translateY(100%);
      opacity: 0;
      pointer-events: none;
      transition:
        transform 0.35s cubic-bezier(0.2, 0.7, 0.2, 1),
        opacity 0.35s ease-out;
      z-index: 190;
    }

    .info-panel.open {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    .info-panel.closing {
      transform: translateY(100%);
      opacity: 0;
      pointer-events: none;
    }

    .info-panel-content {
      font-size: 0.9rem;
      line-height: 1.6;
      white-space: pre-line;
      overflow-y: auto;
      color: rgba(249,250,251,0.96);
    }

    .info-panel-content::-webkit-scrollbar {
      width: 4px;
    }
    .info-panel-content::-webkit-scrollbar-thumb {
      background: rgba(148,163,184,0.55);
      border-radius: 999px;
    }

    @media (min-width: 768px) {
      .panel-inner {
        border-radius: 18px;
        max-width: 900px;
        margin: 0 auto;
      }
      .panel { padding: 0 1.4rem; }
      .info-panel {
        left: 50%;
        right: auto;
        width: min(420px, 70vw);
        transform: translate(50%, 100%);
      }
      .info-panel.open {
        transform: translate(50%, 0);
      }
      .info-panel.closing {
        transform: translate(50%, 100%);
      }
    }
  </style>
</head>
<body>
  <!-- ICONO TEXTO -->
  <div class="info-toggle" id="infoToggle" role="button">
    <span class="info-toggle-lines"></span>
  </div>

  <!-- PANEL TEXTO -->
  <aside class="info-panel" id="infoPanel">
    <div class="info-panel-content" id="infoContent"></div>
  </aside>

  <!-- GALERÍA -->
  <div class="snap-container" id="snapContainer">
    <main id="gallery"></main>
  </div>

  <script>
    const MAX_IMAGES = 40;
    const PATH = "imagenes";
    const PREFIX = "imagen";
    const EXT = ".jpg";

    // Textos de ejemplo (cámbialos por los tuyos)
    const TEXTS = {
      1: "Descripción ejemplo imagen 1.\nPuedes poner técnica, año, medidas, serie, etc.",
      2: "Descripción ejemplo imagen 2.",
      3: "Descripción ejemplo imagen 3.",
    };

    function createPanels() {
      const gallery = document.getElementById("gallery");

      for (let i = 1; i <= MAX_IMAGES; i++) {
        const panel = document.createElement("section");
        panel.className = "panel";
        panel.dataset.index = i;
        panel.style.display = "none";

        const inner = document.createElement("div");
        inner.className = "panel-inner";

        const wrap = document.createElement("div");
        wrap.className = "image-wrapper";

        const img = document.createElement("img");
        img.className = "portfolio-image";
        img.src = `${PATH}/${PREFIX}${i}${EXT}`;
        img.alt = "";

        const grad = document.createElement("div");
        grad.className = "gradient-overlay";

        img.onload = () => { panel.style.display = "flex"; };
        img.onerror = () => { panel.remove(); };

        wrap.appendChild(img);
        inner.appendChild(wrap);
        inner.appendChild(grad);
        panel.appendChild(inner);
        gallery.appendChild(panel);
      }
    }

    // Icono: vuelve a 1 y luego baja a 0.2
    function iconResetAnimation() {
      const icon = document.getElementById("infoToggle");
      icon.style.transition = "none";
      icon.style.opacity = "1";
      setTimeout(() => {
        icon.style.transition = "opacity 1.2s ease-out";
        icon.style.opacity = "0.2";
      }, 900);
    }

    function setupScrollEffects() {
      const container = document.getElementById("snapContainer");
      const panels = [...document.querySelectorAll(".panel")];
      const infoContent = document.getElementById("infoContent");
      const infoPanel = document.getElementById("infoPanel");
      const infoToggle = document.getElementById("infoToggle");

      let activeIndex = null;

      function updatePanels() {
        const rect = container.getBoundingClientRect();
        const center = rect.top + rect.height / 2;

        let closest = null;
        let distMin = Infinity;

        panels.forEach(panel => {
          const p = panel.getBoundingClientRect();
          const pc = p.top + p.height / 2;
          const dist = Math.abs(pc - center);

          const inner = panel.querySelector(".panel-inner");
          const img = panel.querySelector(".portfolio-image");
          const overlay = panel.querySelector(".gradient-overlay");

          // offset vertical normalizado
          const offset = (pc - center) / rect.height; // -0.5 a 0.5 aprox.
          const absOffset = Math.abs(offset);
          const d = Math.min(absOffset * 1.3, 1); // 0 (centro) → 1 (lejos)

          // efecto “sala”: leve desplazamiento en X y Y + escala
          const translateX = offset * 40;  // se cruzan un poco en horizontal
          const translateY = offset * -6;  // leve parallax vertical
          const scale = 0.96 + (1 - d) * 0.10; // centro un poco más grande

          const opacity = 0.6 + (1 - d) * 0.4;  // centro más opaco
          const blur = d * 3.2;                 // máximo ~3px

          inner.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
          inner.style.opacity = opacity.toFixed(3);
          img.style.filter = `blur(${blur.toFixed(1)}px) saturate(${1 + (1 - d) * 0.12})`;
          overlay.style.opacity = (0.08 + (1 - d) * 0.25).toFixed(3);

          // z-index para que el centro quede por encima
          panel.style.zIndex = String(10 + Math.round((1 - d) * 10));

          if (dist < distMin) {
            distMin = dist;
            closest = panel;
          }
        });

        if (closest) {
          const idx = parseInt(closest.dataset.index, 10);

          if (idx !== activeIndex) {
            activeIndex = idx;

            // cerrar suavemente la caja si estaba abierta
            if (infoPanel.classList.contains("open")) {
              infoPanel.classList.remove("open");
              infoPanel.classList.add("closing");
              infoToggle.classList.remove("active");

              setTimeout(() => {
                infoPanel.classList.remove("closing");
              }, 350);
            }

            // actualizar texto para la nueva imagen
            infoContent.textContent = TEXTS[idx] || "";

            // reiniciar pista del icono
            iconResetAnimation();
          }
        }
      }

      container.addEventListener("scroll", () => {
        requestAnimationFrame(updatePanels);
      });

      updatePanels();
    }

    function setupInfoToggle() {
      const icon = document.getElementById("infoToggle");
      const panel = document.getElementById("infoPanel");

      const toggle = () => {
        const isOpen = panel.classList.toggle("open");
        panel.classList.remove("closing");
        icon.classList.toggle("active", isOpen);
      };

      icon.addEventListener("click", toggle);
      icon.addEventListener("touchend", (e) => {
        e.preventDefault();
        toggle();
      }, { passive: false });
    }

    document.addEventListener("DOMContentLoaded", () => {
      createPanels();
      setTimeout(() => {
        setupScrollEffects();
        setupInfoToggle();
        iconResetAnimation();
      }, 300);
    });
  </script>
</body>
</html>
